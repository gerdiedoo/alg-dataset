import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.Arrays;
public class HashTable extends Hashable implements Table {
	private HashBucket[] table;
	private int depth, size;
	public HashTable() {
		this.depth = initialDepth;
		this.size = 1<<depth;
		this.table = new HashBucket[size];
	}
	@Override
	public void insert(String word) {
		word = word.toLowerCase();  
		this.insert(word, 1);
	}
	private void insert(String word, int count) {  
		int key = hash(word)%size;
		if(table[key] == null) {  
			table[key] = new HashBucket();
		}
		if(table[key].isFull()) {  
			if(this.depth - table[key].getDepth() == 0) {  
				doublingSize();
				insert(word, count);
			}else if(this.depth - table[key].getDepth() > 0) {  
				int localKey = key % (1<<table[key].getDepth());  
				int depthDifference = this.depth - table[key].getDepth();  
				table[key].incrementDepth();  
				HashBucket newBucket = new HashBucket(table[key].getDepth());  
				for (int i = localKey; i < size; i+=(size>>depthDifference)) {  
					if(i%(1<<table[key].getDepth()) != key%(1<<table[key].getDepth())) {  
						table[i] = newBucket;
					}
				}
				table[key].transfer(newBucket, key);  
				insert(word, count);  
			}else {
				System.out.println("Error #1\nLocal depth is higher than global depth!");
			}
		}else {
			table[key].insert(word, count);
		}
	}
	@Override
	public boolean search(String word) {
		word = word.toLowerCase();  
		int key = hash(word)%size;
		HashBucket bucket = table[key];
		if(table[key] == null) {  
			System.out.println(word + " bulunamad.");
			return false;  
		}
		WordNode node = bucket.find(word);
		if(node == null) {  
			System.out.println(word + " bulunamad.");
			return false; 
		}
		bucket.print(node);
		System.out.println("Global Depth: " + depth);
		System.out.println();
		return true;
	}
	@Override
	public void loadFromFile(String fileName)  {
		BufferedReader br = null;
		FileReader fr = null;
		try {
			fr = new FileReader(fileName);
			br = new BufferedReader(fr);
			String sCurrentLine;
			while ((sCurrentLine = br.readLine()) != null) {
				sCurrentLine = sCurrentLine.trim();
				String words[] = sCurrentLine.split(" ");
				for(String word:words) {
					word = word.trim();
					if(word.equals("")) continue;
					insert(word);
				}
			}
		} catch (FileNotFoundException e) {  
			e.printStackTrace();
		} catch (IOException e) {  
			e.printStackTrace();
		}
	}
	private void doublingSize() {  
		int size = 1<<depth;
		this.depth++;
		this.table = Arrays.copyOf(table, size*2);  
		for (int i = 0; i < size; i++) {  
			table[size+i] = table[i];
		}
		this.size = 1<<depth;
	}
	public int getDepth() {
		return depth;
	}
	public void print() {
		System.out.println("----------Extendible Hashing----------");
		System.out.println("Global Depth: " + depth);
		for (int i = 0; i < size; i++) {
			if(table[i] != null) {
				System.out.println("");
				table[i].print();
			}
		}
	}
}
package algos;
import java.util.Iterator;
public class HashTable<K, V> implements Iterable<K>
{
    private static class Element<K, V>
    {
        private final K key;
        private V       value;
        public Element(K _key, V _value)
        {
            key = _key;
            value = _value;
        }
        public K getKey()
        {
            return key;
        }
        public V getValue()
        {
            return value;
        }
        public void setValue(V _value)
        {
            this.value = _value;
        }
    }
    private static class ElementList<K, V> implements Iterable<Element<K, V>>
    {
        private final LinkedList<Element<K, V>> elements = new LinkedList<Element<K, V>>();
        public void setValue(K key, V value)
        {
            for (Element<K, V> e : elements) {
                if (e.getKey().equals(key)) {
                    e.setValue(value);
                    return;
                }
            }
            elements.insert(new Element<K, V>(key, value));
        }
        public V getValue(K key, V def)
        {
            for (Element<K, V> e : elements) {
                if (e.getKey().equals(key)) {
                    return e.getValue();
                }
            }
            return def;
        }
        public boolean hasKey(K key)
        {
            for (Element<K, V> e : elements) {
                if (e.getKey().equals(key)) {
                    return true;
                }
            }
            return false;
        }
        public void removeKey(K key)
        {
            Iterator<Element<K, V>> itr = elements.iterator();
            while (itr.hasNext()) {
                if (itr.next().getKey().equals(key)) {
                    itr.remove();
                    return;
                }
            }
        }
        @Override
        public Iterator<Element<K, V>> iterator()
        {
            return elements.iterator();
        }
        public int size()
        {
            return elements.size();
        }
    }
    private final ElementList<K, V>[] data;
    @SuppressWarnings("unchecked")
    public HashTable(int size)
    {
        data = new ElementList[size];
        for (int ii = 0; ii < size; ii++) {
            data[ii] = new ElementList<K, V>();
        }
    }
    private int hash(K key)
    {
        return key.hashCode() % data.length;
    }
    public void set(K key, V value)
    {
        data[hash(key)].setValue(key, value);
    }
    public V get(K key, V def)
    {
        return data[hash(key)].getValue(key, def);
    }
    public V get(K key)
    {
        return get(key, null);
    }
    public boolean hasKey(K key)
    {
        return data[hash(key)].hasKey(key);
    }
    public void delete(K key)
    {
        data[hash(key)].removeKey(key);
    }
    @Override
    public Iterator<K> iterator()
    {
        return new Iterator<K>()
        {
            private int                     bucket  = 0;
            private Iterator<Element<K, V>> itr     = null;
            private Iterator<Element<K, V>> previtr = null;
            private boolean findNextBucket()
            {
                for (; bucket < data.length; bucket++) {
                    if (data[bucket].size() > 0) {
                        itr = data[bucket].iterator();
                        return true;
                    }
                }
                itr = null;
                return false;
            }
            @Override
            public boolean hasNext()
            {
                if (itr != null) {
                    return itr.hasNext();
                }
                return findNextBucket();
            }
            @Override
            public K next()
            {
                if (itr == null) {
                    if (!hasNext()) {
                        return null;
                    }
                }
                Element<K, V> elt = itr.next();
                previtr = itr;
                if (!itr.hasNext()) {
                    bucket++;
                    findNextBucket();
                }
                if (elt == null) {
                    return null;
                }
                return elt.getKey();
            }
            @Override
            public void remove()
            {
                if (previtr != null) {
                    previtr.remove();
                }
            }
        };
    }
    @Override
    public String toString()
    {
        StringBuilder sb = new StringBuilder("{");
        boolean isFirst = true;
        for (K key : this) {
            if (isFirst) {
                isFirst = false;
            }
            else {
                sb.append(", ");
            }
            sb.append("(");
            sb.append(key);
            sb.append(", ");
            sb.append(get(key));
            sb.append(")");
        }
        sb.append("}");
        return sb.toString();
    }
}